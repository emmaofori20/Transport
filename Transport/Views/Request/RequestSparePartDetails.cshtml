@model VehicleMaintenanceRequestDetailsViewModel

@{
    ViewBag.Title = "Details";

    int Id = (int)ViewData["RequestListId"];
    int SerialNum = 0;

}

<link rel="stylesheet" type="text/css" href="~/app-assets/vendors/css/ui/prism.min.css">
<link href="~/lib/dropzone/min/dropzone.min.css" rel="stylesheet" />
<link href="~/lib/dropzone/min/basic.min.css" rel="stylesheet" />

<div class="content-body">
    <section class="card">
        <div id="invoice-template" class="card-body">
            <!-- Invoice Company Details -->
            <div id="invoice-company-details" class="row">
                <div class="col-md-6 col-sm-12 text-center text-md-left">
                    <div class="media">
                        <img src="~/app-assets/images/logo/bus.png" alt="company logo" style="height:70px;width:70px" class="" />
                        <div class="media-body">
                            <ul class="ml-2 px-0 list-unstyled">
                                <li class="text-bold-800">KNUST TRANSPORT UNIT</li>
                                <li>KUMASI,ASHANTI REGION</li>
                                <li>Ghana</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12 text-center text-md-right">
                    <h2>Request Form</h2>
                    <p class="pb-3"># INV-@Id</p>
                    @*<ul class="px-0 list-unstyled">
                            <li>Maintenanance Cost</li>
                            <li class="lead text-bold-800">Ghc @Model.MaintenanceCost</li>
                        </ul>*@
                </div>
            </div>
            <!--/ Invoice Company Details -->
            <!-- Invoice Customer Details -->
            <div id="invoice-customer-details" class="row pt-2">
                <div class="col-sm-12 text-center text-md-left">
                    <p class="text-muted">Maintaned By</p>
                </div>
                <div class="col-md-6 col-sm-12 text-center text-md-left">
                    <ul class="px-0 list-unstyled">
                        <li class="text-bold-800">@Model.MaintainedBy</li>
                    </ul>
                </div>
                <div class="col-md-6 col-sm-12 text-center text-md-right">
                    <p>
                        <span class="text-muted"> Date :</span> @Model.Date
                    </p>
                    <p>
                        <span class="text-muted">Vehicle Registration Number :</span> @Model.RegistrationNumber
                    </p>
                    <p>
                        <span class="text-muted">Request Status :</span> <h6 class="text-bold-600">@Model.Status</h6>
                    </p>

                </div>
            </div>
            <!--/ Invoice Customer Details -->
            <!-- Invoice Items Details -->
            <div id="invoice-items-details" class="pt-2">
                <div class="row">
                    <div class="table-responsive col-sm-12">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Item </th>
                                    <th class="text-right">Quantity</th>
                                    <th class="text-right">Unit Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < @Model.spareParts.Count; i++)
                                {
                                    <tr>
                                        <th scope="row">@(++SerialNum) </th>
                                        <td>
                                            <p>@Model.spareParts[i].SparePartName</p>
                                        </td>
                                        <td class="text-right">@Model.spareParts[i].Quantity</td>
                                        <td class="text-right">Ghc @Model.spareParts[i].Amount</td>
                                    </tr>
                                }


                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">

                    <div class="col-md-5 col-sm-12">
                        <p class="lead ">Total Amount: <span class=" text-bold-800">Ghc @Model.spareParts.Sum(c => c.Amount * c.Quantity)  </span>  </p>
                    </div>
                </div>
            </div>
            
            <!--Upload Receipts or Images-->
            @if (@Model.Status == "Pending")
            {

            }
            else
            {
                <div class="row">
                    <div class="col-12">
                        <div class="card">

                            <div class="card-content collapse show">
                                <div class="card-body">
                                    <p class="card-text" style="text-align:center; font-size:23px">
                                        Upload receipts or pictures of the spare parts
                                    </p>

                                    <form enctype="multipart/form-data" action="/Request/UploadReceipts" method="post" class="dropzone"
                                          id="my-awesome-dropzone">
                                    </form>

                                    @*<form id="myDropzone" method="post" asp-controller="Request" asp-action="UploadReceipts">
            <br />

            <div>
                <div id="previews" class="dz-default dz-message box__input dropzone">
                    <div style="text-align:center">
                        <i class="fa fa-cloud-upload" style="font-size:23px;position:relative;top:4px;"></i> <span style="margin-left:20px">Drop files  to attach or browse</span>
                    </div>
                </div>
            </div>
            <br />
            <div>
                <input type="submit" id="Submit" name="Submit" class="btn btn-success m-t-5" value="Submit" />
            </div>
        </form>*@






                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            }
        </div>
    </section>
</div>

<script src="~/app-assets/vendors/js/vendors.min.js" type="text/javascript"></script>

<script src="~/lib/dropzone/min/dropzone.min.js"></script>

<script>
    Dropzone.options.myAwesomeDropzone = {
        //maxFilesize: 5,
        //maxFiles: 1,
        addRemoveLinks: true,
        dictResponseError: 'Server not Configured',
        //acceptedFiles: ".pdf",
        init: function () {
            var self = this;
            // config
            self.options.addRemoveLinks = true;
            self.options.dictRemoveFile = "Delete";
            //New file added
            self.on("addedfile", function (file) {
                console.log('new file added ', file);
                if (!confirm("Do you want to upload the file?")) {
                    this.removeFile(file);
                    return false;
                }

            });

            debugger;
            // Send file starts
            self.on("sending", function (file, xhr, formData) {
                debugger;

                console.log('upload started', file);
                $('.meter').show();

                var form_data = new FormData("#my-awesome-dropzone");

                $.ajax({
                    url: '/Request/UploadReceipts',
                    data: 'file=' + file.name,
                    type: 'POST',
                    processData: false,
                    contentType: false,
                    success: function (response) {
                    }
                });
            });

            // File upload Progress
            self.on("totaluploadprogress", function (progress) {
                console.log("progress ", progress);
                $('.roller').width(progress + '%');
            });

            self.on("queuecomplete", function (progress) {
                $('.meter').delay(999).slideUp(999);
            });

            // On removing file
            self.on("removedfile", function (file) {
                console.log(file);
            });
      /*  //*/}
</script>

@*<script>
    var currentFile = null;
    var response = [];
    Dropzone.autoDiscover = false;

    Dropzone.autoDiscover = false;
    $('#myDropzone').dropzone({
        //parameter name value
        paramName: "files",
        //clickable div id
        //clickable: '#previews',
        ////preview files container Id
        //previewsContainer: "#previewFiles",
        autoProcessQueue: false,
        uploadMultiple: true,
        parallelUploads: 100,
        maxFiles: 100,
        //  url:"/", // url here to save file
        maxFilesize: 100,//max file size in MB,
        addRemoveLinks: true,
        dictResponseError: 'Server not Configured',
        acceptedFiles: ".png,.jpg,.gif,.bmp,.jpeg,.pdf",// use this to restrict file type
        init: function () {
            var self = this;
            // config
            self.options.addRemoveLinks = true;
            self.options.dictRemoveFile = "Delete";
            //New file added
            self.on("addedfile", function (file) {
                console.log('new file added ', file);
                $('.dz-success-mark').hide();
                $('.dz-error-mark').hide();
            });
            // Send file starts
            self.on("sending", function (file) {
                console.log('upload started', file);
                $('.meter').show();
            });

            // File upload Progress
            self.on("totaluploadprogress", function (progress) {
                console.log("progress ", progress);
                $('.roller').width(progress + '%');
            });

            self.on("queuecomplete", function (progress) {
                $('.meter').delay(999).slideUp(999);
            });

            // On removing file
            self.on("removedfile", function (file) {
                console.log(file);
            });

            $('#Submit').on("click", function (e) {
                e.preventDefault();
                e.stopPropagation();
                // Validate form here if needed

                var form = new FormData(document.getElementById("myDropzone"));
                console.log(form);

            });



            self.on("successmultiple", function (files, response) {
                // Gets triggered when the files have successfully been sent.
                // Redirect user or notify of success.

            });
        }
    });
   
</script>*@